<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vokabeltrainer (Local)</title>
<style>
  :root{--bg:#0b1220;--card:#071427;--accent:#57d0ff;--muted:#9fb3c9;--good:#8ee08a;--bad:#ff7b7b}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#02101a,#072231);color:#e6f6ff}
  .wrap{max-width:980px;margin:18px auto;padding:14px;}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between}
  header h1{margin:0;font-size:20px;letter-spacing:0.2px}
  .row{display:flex;gap:12px;align-items:center}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:12px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer}
  button.ghost{border:1px dashed rgba(255,255,255,0.03);color:var(--muted);font-weight:600}
  input,textarea,select{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:#eaf6ff}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:14px}
  @media(max-width:900px){ .grid{grid-template-columns:1fr} }
  .list{max-height:60vh;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
  .item{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .meta{font-size:13px;color:var(--muted)}
  .badge{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-weight:700;color:var(--muted);font-size:12px}
  .big{font-size:18px}
  footer{margin-top:18px;color:var(--muted);font-size:13px}
  .practiceArea{display:flex;flex-direction:column;gap:12px}
  .card.center{display:grid;place-items:center;min-height:220px}
  .answerBtns{display:flex;gap:8px;justify-content:center}
  .correct{background:linear-gradient(90deg, rgba(34,170,84,0.22), rgba(34,170,84,0.1)); border-color: rgba(34,170,84,0.4); color:var(--good)}
  .wrong{background:linear-gradient(90deg, rgba(220,80,80,0.16), rgba(220,80,80,0.06)); border-color: rgba(220,80,80,0.35); color:var(--bad)}
  .small{font-size:13px;padding:6px 8px}
  .muted{color:var(--muted)}
  textarea{min-height:68px;resize:vertical}
  .tag{background:#082532;padding:6px 8px;border-radius:999px;color:var(--muted);font-size:12px;margin-right:6px}
  .controls .danger{color:#ff9aa2;border-color:rgba(255,255,255,0.03)}
  .flex{display:flex;align-items:center;gap:8px}
  .spaced{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Vokabeltrainer -- Local (Speichert im Browser)</h1>
      <div class="row">
        <div class="controls">
          <button id="btnNew">‚ûï Neue Vokabel</button>
          <button id="btnPractice">‚ñ∂ Lernen</button>
          <button id="btnExport">‚¨á Export</button>
          <button id="btnImport" class="ghost">‚¨Ü Import</button>
          <button id="btnReset" class="danger ghost">üóëÔ∏è Reset</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- Links: Liste & Add -->
      <div>
        <div class="card">
          <div class="spaced">
            <div>
              <strong>Filter</strong>
              <div class="muted">Suche / Tag / f√§llig</div>
            </div>
            <div class="flex">
              <input id="search" placeholder="Suchen..." style="min-width:160px"/>
              <select id="tagFilter">
                <option value="">Alle Tags</option>
              </select>
              <label style="margin-left:6px"><input type="checkbox" id="onlyDue"/> Nur f√§llige</label>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:10px">
          <strong>Vokabelliste</strong>
          <div class="muted" style="font-size:13px;margin-top:6px">Klicke auf eine Vokabel zum bearbeiten oder auf ‚ñ∂ um zu lernen.</div>
          <div id="list" class="list" style="margin-top:10px"></div>
        </div>
      </div>

      <!-- Rechts: Editor / Practice -->
      <div>
        <div id="editor" class="card">
          <strong id="editorTitle">Neue Vokabel</strong>
          <div style="margin-top:8px">
            <label>Vorderseite (z.B. Deutsch)</label>
            <input id="front" placeholder="z. B. Haus / der Hund" />
            <label>R√ºckseite (z.B. Englisch)</label>
            <input id="back" placeholder="z. B. house / dog" />
            <label>Notiz (Beispiel, Aussprache)</label>
            <textarea id="note" placeholder="z. B. Aussprache, Beispielsatz"></textarea>
            <label>Tags (Komma getrennt)</label>
            <input id="tags" placeholder="z. B. Reisen, Uni" />
            <div style="margin-top:10px;display:flex;gap:8px">
              <button id="saveBtn">Speichern</button>
              <button id="newClear" class="ghost">Neu</button>
            </div>
          </div>
        </div>

        <div id="practicePanel" class="card center" style="margin-top:12px;display:none">
          <!-- Lernmodus UI -->
          <div class="practiceArea" style="width:100%">
            <div class="spaced">
              <div>
                <strong id="practiceModeTitle">Lernmodus</strong>
                <div class="muted small" id="practiceMeta">--</div>
              </div>
              <div>
                <button id="btnBackToList" class="ghost small">Zur√ºck</button>
              </div>
            </div>

            <div id="practiceCard" class="card center" style="min-height:160px;margin-top:8px">
              <div id="cardFront" class="big">--</div>
              <div id="cardNote" class="muted small" style="margin-top:8px"></div>
            </div>

            <div class="answerBtns">
              <button id="showAnswer" class="small">Antwort zeigen</button>
            </div>

            <div id="answerArea" style="display:none;flex-direction:column;gap:8px">
              <div class="card" id="theAnswer" style="text-align:center;font-size:18px"></div>
              <div class="answerBtns">
                <button id="btnCorrect" class="correct small">‚úîÔ∏è Korrekt</button>
                <button id="btnWrong" class="wrong small">‚ùå Falsch</button>
              </div>
            </div>

            <div style="display:flex;justify-content:space-between;margin-top:6px">
              <div class="muted small" id="progressInfo">--</div>
              <div class="muted small" id="statsInfo">--</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer>
      Tipp: Exportiere regelm√§√üig (Export) oder nutze Import um die Datei zu laden. Die Daten liegen lokal in deinem Browser (localStorage).
    </footer>
  </div>

  <input id="fileInput" type="file" accept="application/json" style="display:none" />

<script>
/* Vokabeltrainer JS
   - Speichert in localStorage unter key VOCAB_APP_DATA
   - Datenmodell: { id, front, back, note, tags[], box(1-5), nextReview: ISOString, correct, wrong, created }
   - SRS intervals (Tage) f√ºr box 1..5: [0,1,3,7,14] (simple)
*/

const STORAGE_KEY = 'VOCAB_APP_DATA_v1';
const INTERVALS = [0,1,3,7,14]; // box idx: 1..5 maps to these days

// DOM
const listEl = document.getElementById('list');
const btnNew = document.getElementById('btnNew');
const btnPractice = document.getElementById('btnPractice');
const btnExport = document.getElementById('btnExport');
const btnImport = document.getElementById('btnImport');
const btnReset = document.getElementById('btnReset');

const editorTitle = document.getElementById('editorTitle');
const frontIn = document.getElementById('front');
const backIn = document.getElementById('back');
const noteIn = document.getElementById('note');
const tagsIn = document.getElementById('tags');
const saveBtn = document.getElementById('saveBtn');
const newClear = document.getElementById('newClear');

const searchIn = document.getElementById('search');
const tagFilter = document.getElementById('tagFilter');
const onlyDue = document.getElementById('onlyDue');

const fileInput = document.getElementById('fileInput');

// Practice
const practicePanel = document.getElementById('practicePanel');
const practiceCard = document.getElementById('practiceCard');
const cardFront = document.getElementById('cardFront');
const cardNote = document.getElementById('cardNote');
const btnBackToList = document.getElementById('btnBackToList');
const showAnswer = document.getElementById('showAnswer');
const answerArea = document.getElementById('answerArea');
const theAnswer = document.getElementById('theAnswer');
const btnCorrect = document.getElementById('btnCorrect');
const btnWrong = document.getElementById('btnWrong');
const practiceMeta = document.getElementById('practiceMeta');
const progressInfo = document.getElementById('progressInfo');
const statsInfo = document.getElementById('statsInfo');

let vocab = []; // in-memory
let currentEditId = null;
let practiceQueue = [];
let currentIndex = 0;
let currentCard = null;

// ---------- Storage ----------
function load() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) { vocab = []; save(); return; }
    vocab = JSON.parse(raw) || [];
  } catch(e) { console.error('Load error', e); vocab = []; }
}
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(vocab));
}

// ---------- Helpers ----------
function uid() { return Math.random().toString(36).slice(2,10); }
function todayISO() { const d=new Date(); d.setHours(0,0,0,0); return d.toISOString(); }
function daysFromNow(days) { const d=new Date(); d.setDate(d.getDate()+days); d.setHours(0,0,0,0); return d.toISOString(); }
function isDue(item) {
  if(!item.nextReview) return true;
  return new Date(item.nextReview) <= (new Date());
}
function parseTags(s) {
  return (s||'').split(',').map(t=>t.trim()).filter(t=>t);
}

// create sample on first run
function ensureSample(){
  if(vocab.length === 0){
    vocab.push({
      id: uid(),
      front: 'Haus',
      back: 'house',
      note: 'das Haus -- plural: H√§user',
      tags: ['Alltag'],
      box: 1,
      nextReview: todayISO(),
      correct: 0, wrong: 0,
      created: new Date().toISOString()
    });
    vocab.push({
      id: uid(),
      front: 'Danke',
      back: 'thank you',
      note: '',
      tags: ['H√∂flichkeit'],
      box: 2,
      nextReview: daysFromNow(1),
      correct: 1, wrong: 0,
      created: new Date().toISOString()
    });
    save();
  }
}

// ---------- UI Rendering ----------
function renderList() {
  listEl.innerHTML = '';
  const q = (searchIn.value||'').toLowerCase();
  const selectedTag = tagFilter.value;
  const only = onlyDue.checked;
  const filtered = vocab
    .filter(item => {
      if(q && !(item.front||'').toLowerCase().includes(q) && !(item.back||'').toLowerCase().includes(q) && !(item.note||'').toLowerCase().includes(q)) return false;
      if(selectedTag && !(item.tags||[]).includes(selectedTag)) return false;
      if(only && !isDue(item)) return false;
      return true;
    })
    .sort((a,b)=> new Date(a.nextReview || 0) - new Date(b.nextReview || 0));
  if(filtered.length === 0){
    const p = document.createElement('div'); p.className='muted'; p.textContent='Keine Vokabeln gefunden.'; listEl.appendChild(p); return;
  }
  for(const it of filtered){
    const div = document.createElement('div'); div.className='item';
    const left = document.createElement('div');
    const title = document.createElement('div'); title.innerHTML = `<strong>${escapeHtml(it.front)}</strong> -- <span class="muted">${escapeHtml(it.back)}</span>`;
    const meta = document.createElement('div'); meta.className='meta';
    meta.innerHTML = `Box ${it.box} ‚Ä¢ ${it.tags.map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join(' ')} ‚Ä¢ N√§chste: ${it.nextReview ? (new Date(it.nextReview)).toLocaleDateString() : 'sofort'}`;
    left.appendChild(title); left.appendChild(meta);
    const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';
    const btnEdit = document.createElement('button'); btnEdit.textContent = '‚úèÔ∏è'; btnEdit.title='Bearbeiten';
    btnEdit.onclick = ()=> editItem(it.id);
    const btnDel = document.createElement('button'); btnDel.textContent='üóëÔ∏è'; btnDel.title='L√∂schen';
    btnDel.onclick = ()=> { if(confirm('Vokabel l√∂schen?')) { vocab = vocab.filter(x=>x.id!==it.id); save(); render(); } };
    const btnLearn = document.createElement('button'); btnLearn.textContent='‚ñ∂'; btnLearn.title='Lernen (nur diese)';
    btnLearn.onclick = ()=> startPractice([it]);
    right.appendChild(btnLearn); right.appendChild(btnEdit); right.appendChild(btnDel);
    div.appendChild(left); div.appendChild(right);
    listEl.appendChild(div);
  }
}

function populateTagFilter(){
  const tags = new Set();
  for(const it of vocab) (it.tags||[]).forEach(t=>tags.add(t));
  tagFilter.innerHTML = '<option value="">Alle Tags</option>';
  Array.from(tags).sort().forEach(t=>{
    const opt = document.createElement('option'); opt.value=t; opt.textContent=t; tagFilter.appendChild(opt);
  });
}

function render(){
  renderList();
  populateTagFilter();
  updateStats();
}

// ---------- Editor ----------
btnNew.addEventListener('click', ()=>{ currentEditId = null; editorTitle.textContent='Neue Vokabel'; frontIn.value=''; backIn.value=''; noteIn.value=''; tagsIn.value=''; frontIn.focus(); });

saveBtn.addEventListener('click', ()=>{
  const front = frontIn.value.trim();
  const back = backIn.value.trim();
  if(!front || !back) { alert('Front und R√ºckseite m√ºssen ausgef√ºllt sein.'); return; }
  const tags = parseTags(tagsIn.value);
  if(currentEditId){
    const it = vocab.find(x=>x.id===currentEditId);
    if(!it) return;
    it.front = front; it.back = back; it.note = noteIn.value.trim(); it.tags = tags;
  } else {
    const item = {
      id: uid(), front, back, note: noteIn.value.trim(), tags,
      box: 1, nextReview: todayISO(), correct:0, wrong:0, created: new Date().toISOString()
    };
    vocab.push(item);
  }
  save();
  render();
  currentEditId = null;
  editorTitle.textContent='Neue Vokabel';
  frontIn.value=''; backIn.value=''; noteIn.value=''; tagsIn.value='';
});

newClear.addEventListener('click', ()=>{ currentEditId = null; editorTitle.textContent='Neue Vokabel'; frontIn.value=''; backIn.value=''; noteIn.value=''; tagsIn.value=''; });

// Edit load
function editItem(id){
  const it = vocab.find(x=>x.id===id);
  if(!it) return;
  currentEditId = id;
  editorTitle.textContent='Vokabel bearbeiten';
  frontIn.value = it.front;
  backIn.value = it.back;
  noteIn.value = it.note || '';
  tagsIn.value = (it.tags||[]).join(', ');
}

// ---------- Practice ----------
btnPractice.addEventListener('click', ()=> startPractice());

function startPractice(specificList){
  // build queue
  let pool = vocab.slice();
  // prefer due items
  pool.sort((a,b)=>{
    const da = isDue(a) ? 0 : 1;
    const db = isDue(b) ? 0 : 1;
    return da - db || new Date(a.nextReview) - new Date(b.nextReview);
  });
  if(specificList && specificList.length>0) pool = specificList.slice();
  if(pool.length === 0){ alert('Keine Vokabeln vorhanden.'); return; }
  practiceQueue = pool.filter(Boolean);
  currentIndex = 0;
  showPracticeUI();
  nextCard();
}

function showPracticeUI(){
  document.getElementById('editor').style.display='none';
  practicePanel.style.display='block';
  document.getElementById('list').closest('.card').style.display='none';
  document.getElementById('practiceModeTitle').textContent = 'Lernmodus';
}

btnBackToList.addEventListener('click', ()=> {
  hidePracticeUI();
});

function hidePracticeUI(){
  practicePanel.style.display='none';
  document.getElementById('editor').style.display='block';
  document.getElementById('list').closest('.card').style.display='block';
}

function nextCard(){
  if(currentIndex >= practiceQueue.length){
    // finished
    cardFront.textContent = 'Fertig üéâ';
    cardNote.textContent = '';
    answerArea.style.display='none';
    showAnswer.style.display='none';
    progressInfo.textContent = `0 / ${practiceQueue.length}`;
    statsInfo.textContent = '';
    return;
  }
  currentCard = practiceQueue[currentIndex];
  cardFront.textContent = currentCard.front;
  cardNote.textContent = currentCard.note || '';
  theAnswer.textContent = '';
  answerArea.style.display='none';
  showAnswer.style.display='inline-block';
  updatePracticeMeta();
  progressInfo.textContent = `${currentIndex+1} / ${practiceQueue.length} (f√§llig: ${practiceQueue.filter(isDue).length})`;
  statsInfo.textContent = `Korrekt: ${currentCard.correct} ‚Ä¢ Falsch: ${currentCard.wrong} ‚Ä¢ Box: ${currentCard.box}`;
}

showAnswer.addEventListener('click', ()=>{
  theAnswer.textContent = currentCard.back;
  answerArea.style.display='flex';
  showAnswer.style.display='none';
});

btnCorrect.addEventListener('click', ()=> {
  markAnswer(true);
});
btnWrong.addEventListener('click', ()=> {
  markAnswer(false);
});

function markAnswer(correct){
  if(!currentCard) return;
  if(correct){
    currentCard.correct = (currentCard.correct||0)+1;
    currentCard.box = Math.min(5, (currentCard.box||1) + 1);
  } else {
    currentCard.wrong = (currentCard.wrong||0)+1;
    currentCard.box = Math.max(1, (currentCard.box||1) - 1);
  }
  // schedule next review using INTERVALS
  const days = INTERVALS[Math.max(0, Math.min(4, currentCard.box-1))] || 0;
  currentCard.nextReview = daysFromNow(days);
  save();
  currentIndex++;
  nextCard();
}

function updatePracticeMeta(){
  practiceMeta.textContent = `Word: ${currentCard.front} ‚Ä¢ Tags: ${(currentCard.tags||[]).join(', ')}`;
  progressInfo.textContent = `${currentIndex+1} / ${practiceQueue.length}`;
}

// ---------- Import / Export ----------
btnExport.addEventListener('click', ()=>{
  const data = { exportedAt: new Date().toISOString(), vocab };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'vocab_backup_' + (new Date().toISOString().slice(0,10)) + '.json';
  a.click();
  URL.revokeObjectURL(url);
});

btnImport.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  try {
    const txt = await f.text();
    const parsed = JSON.parse(txt);
    if(parsed && parsed.vocab && Array.isArray(parsed.vocab)){
      if(confirm('Importiert wird eine Datei mit ' + parsed.vocab.length + ' Eintr√§gen. Anh√§ngen statt √ºberschreiben? OK = anh√§ngen, Abbrechen = √ºberschreiben')) {
        // append but avoid id collision
        const existingIds = new Set(vocab.map(x=>x.id));
        for(const it of parsed.vocab){
          if(existingIds.has(it.id)) it.id = uid();
          vocab.push(it);
        }
      } else {
        vocab = parsed.vocab;
      }
      save(); render();
      alert('Import erfolgreich.');
    } else {
      alert('Ung√ºltiges Format: Datei enth√§lt kein vocab Array.');
    }
  } catch(err) {
    alert('Import-Fehler: ' + err.message);
  } finally {
    fileInput.value = '';
  }
});

// Reset (delete all)
btnReset.addEventListener('click', ()=>{
  if(confirm('Alle Vokabeln l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
    vocab = []; save(); render();
    alert('Gel√∂scht.');
  }
});

// ---------- Utility & Stats ----------
function updateStats(){
  const total = vocab.length;
  const due = vocab.filter(isDue).length;
  const mastered = vocab.filter(v=>v.box>=4).length;
  document.getElementById('practiceModeTitle').textContent = `Lernen -- ${due} f√§llig / ${total} gesamt`;
  // small stats area
  const totalCorrect = vocab.reduce((s,i)=>s + (i.correct||0), 0);
  const totalWrong = vocab.reduce((s,i)=>s + (i.wrong||0), 0);
  // statsInfo may be used in practice
  statsInfo.textContent = `Gesamt: ${total} ‚Ä¢ F√§llig: ${due} ‚Ä¢ ‚úî ${totalCorrect} / ‚úñ ${totalWrong}`;
}

function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

// Search and filter bindings
searchIn.addEventListener('input', renderList);
tagFilter.addEventListener('change', renderList);
onlyDue.addEventListener('change', renderList);

// click list area to show editor if click on header area etc.
document.getElementById('list').addEventListener('click', ()=>{ /* noop */ });

// init
load();
ensureSample();
render();

</script>
</body>
</html>