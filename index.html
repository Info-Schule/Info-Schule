<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>MoodMap GeoGame</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 70vh; }
    #menu { padding: 10px; background: #f0f0f0; display:flex; gap:10px; align-items:center; }
    #menu button { padding:5px 10px; cursor:pointer; }
    #loginForm { display:none; margin:10px; }
    input { margin:5px; padding:5px; }
  </style>
</head>
<body>

<div id="menu">
  <button id="loginBtn">Login / Register</button>
  <select id="colorSelect">
    <option value="red">Rot</option>
    <option value="blue">Blau</option>
    <option value="green">Gr체n</option>
    <option value="orange">Orange</option>
  </select>
  <span id="userInfo"></span>
  <button id="logoutBtn" style="display:none;">Logout</button>
</div>

<div id="loginForm">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Passwort">
  <button id="registerBtn">Register</button>
  <button id="loginSubmitBtn">Login</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ================= Firebase Config =================
  const firebaseConfig = {
    apiKey: "DEIN_API_KEY",
    authDomain: "DEIN_PROJECT_ID.firebaseapp.com",
    projectId: "DEIN_PROJECT_ID",
    storageBucket: "DEIN_PROJECT_ID.appspot.com",
    messagingSenderId: "DEINE_SENDER_ID",
    appId: "DEIN_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ================= Login / Register =================
  const loginBtn = document.getElementById('loginBtn');
  const loginForm = document.getElementById('loginForm');
  const registerBtn = document.getElementById('registerBtn');
  const loginSubmitBtn = document.getElementById('loginSubmitBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const userInfo = document.getElementById('userInfo');

  loginBtn.onclick = () => loginForm.style.display = loginForm.style.display === 'none' ? 'block' : 'none';

  registerBtn.onclick = async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    try {
      await auth.createUserWithEmailAndPassword(email, password);
      alert('User registered!');
    } catch(e) { alert(e.message); }
  };

  loginSubmitBtn.onclick = async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    try {
      await auth.signInWithEmailAndPassword(email, password);
      loginForm.style.display = 'none';
    } catch(e) { alert(e.message); }
  };

  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    if(user){
      userInfo.innerText = 'Angemeldet als: ' + user.email;
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
    } else {
      userInfo.innerText = '';
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
    }
  });

  // ================= Leaflet Map =================
  const map = L.map('map').setView([51.1657, 10.4515], 6); // Mitte Deutschland

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  // Standort abfragen
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const marker = L.marker([lat, lon], {color: 'blue'}).addTo(map);
      map.setView([lat, lon], 13);
    }, err => alert('Standort konnte nicht ermittelt werden.'));
  } else {
    alert('Geolocation wird von deinem Ger채t nicht unterst체tzt.');
  }

  // ================= Farben =================
  const colorSelect = document.getElementById('colorSelect');
  colorSelect.onchange = () => {
    alert('Farbe gew채hlt: ' + colorSelect.value);
  };

  // ================= LocalStorage Backup =================
  if(localStorage.getItem('level') === null) localStorage.setItem('level', '1');
  if(localStorage.getItem('points') === null) localStorage.setItem('points', '0');

  console.log('Level:', localStorage.getItem('level'), 'Points:', localStorage.getItem('points'));
</script>

</body>
</html>