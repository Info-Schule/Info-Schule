<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Study Helper -- Lernkarten & Quiz</title>
<style>
  :root{
    --bg:#0b1220; --card:#071427; --accent:#57d0ff; --muted:#9fb3c9;
    --good:#8ee08a; --bad:#ff7b7b;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#02101a,#072231);color:#eaf6ff}
  .wrap{max-width:980px;margin:18px auto;padding:14px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{margin:0;font-size:20px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer}
  .ghost{border:1px dashed rgba(255,255,255,0.03);color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:14px}
  @media(max-width:900px){ .grid{grid-template-columns:1fr} }
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:12px}
  .list{max-height:60vh;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
  .item{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input,textarea,select{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:#eaf6ff;width:100%}
  textarea{min-height:68px;resize:vertical}
  .muted{color:var(--muted)}
  .big{font-size:18px}
  .center{display:grid;place-items:center}
  .answerBtns{display:flex;gap:8px;justify-content:center;margin-top:8px}
  .small{font-size:13px;padding:6px 8px}
  .tag{background:#082532;padding:6px 8px;border-radius:999px;color:var(--muted);font-size:12px;margin-right:6px}
  footer{margin-top:18px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Study Helper -- Karteikarten & Quiz</h1>
      <div class="controls">
        <button id="btnNew">‚ûï Karte</button>
        <button id="btnStudy">‚ñ∂ Lernen</button>
        <button id="btnQuiz">üß™ Quiz</button>
        <button id="btnExport">‚¨á Export</button>
        <button id="btnImport" class="ghost">‚¨Ü Import</button>
        <button id="btnReset" class="ghost">üóëÔ∏è Reset</button>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong>Filter & Suche</strong><div class="muted">Suche in Frage/Antwort, Tags</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="search" placeholder="Suchen..." style="min-width:180px"/>
              <select id="tagFilter"><option value="">Alle Tags</option></select>
              <label style="margin-left:8px"><input id="onlyDue" type="checkbox"/> Nur f√§llig</label>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:10px">
          <strong>Karteikarten</strong>
          <div class="muted" style="font-size:13px">Klicke Karte ‚ûú Bearbeiten ‚Ä¢ ‚ñ∂ Lernen (nur diese)</div>
          <div id="list" class="list" style="margin-top:10px"></div>
        </div>
      </div>

      <div>
        <div id="editor" class="card">
          <strong id="editorTitle">Neue Karte</strong>
          <div style="margin-top:8px">
            <label>Frage / Vorderseite</label>
            <input id="front" placeholder="z. B. Was ist die Hauptstadt von X?" />
            <label>Antwort / R√ºckseite</label>
            <textarea id="back" placeholder="z. B. Hauptstadt ..."></textarea>
            <label>Notiz (z. B. Formel, Beispiele)</label>
            <textarea id="note" placeholder="optional"></textarea>
            <label>Tags (Komma getrennt)</label>
            <input id="tags" placeholder="z. B. Mathe, Vokabeln" />
            <div style="margin-top:10px;display:flex;gap:8px">
              <button id="saveBtn">Speichern</button>
              <button id="newClear" class="ghost">Neu</button>
            </div>
          </div>
        </div>

        <div id="studyPanel" class="card center" style="margin-top:12px;display:none">
          <div style="width:100%">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <strong id="studyTitle">Lernmodus</strong>
                <div class="muted small" id="studyMeta">--</div>
              </div>
              <div>
                <button id="btnBack" class="ghost small">Zur√ºck</button>
              </div>
            </div>

            <div id="studyCard" class="card center" style="min-height:180px;margin-top:8px">
              <div id="cardFront" class="big">--</div>
              <div id="cardNote" class="muted" style="margin-top:8px"></div>
            </div>

            <div class="answerBtns">
              <button id="showAnswer" class="small">Antwort zeigen</button>
            </div>

            <div id="answerArea" style="display:none;flex-direction:column;gap:8px">
              <div class="card" id="theAnswer" style="text-align:center;font-size:18px"></div>
              <div class="answerBtns">
                <button id="btnCorrect" class="small" style="background:var(--good);border:none">‚úî Korrekt</button>
                <button id="btnWrong" class="small" style="background:var(--bad);border:none">‚ùå Falsch</button>
              </div>
            </div>

            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <div class="muted small" id="progressInfo">--</div>
              <div class="muted small" id="statsInfo">--</div>
            </div>
          </div>
        </div>

        <div id="quizPanel" class="card" style="margin-top:12px;display:none">
          <strong>Quiz (Multiple Choice)</strong>
          <div class="muted" style="font-size:13px">W√§hle Anzahl Fragen und Zeitlimit pro Frage.</div>
          <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
            <label style="min-width:120px">Fragen:</label>
            <input id="quizCount" type="number" value="10" min="1" style="width:80px"/>
            <label style="min-width:120px">Zeit / Frage (Sek.):</label>
            <input id="quizTime" type="number" value="20" min="5" style="width:80px"/>
            <button id="startQuiz" class="small">Start</button>
          </div>

          <div id="quizArea" style="margin-top:12px;display:none">
            <div id="quizCard" class="card center" style="min-height:140px">
              <div id="quizQ" class="big">Frage</div>
              <div id="quizTimer" class="muted" style="margin-top:6px">Zeit:</div>
            </div>
            <div id="quizChoices" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px"></div>
            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <div class="muted" id="quizProgress">0 / 0</div>
              <div class="muted" id="quizScore">Score: 0</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer>Die App speichert Karten lokal im Browser (localStorage). Nutze Export/Import f√ºr Backups.</footer>

    <input id="fileInput" type="file" accept="application/json" style="display:none"/>
  </div>

<script>
/* Simple Study Helper - saves to localStorage
   Data model: { id, front, back, note, tags[], box(1-5), nextReview, correct, wrong, created }
*/
const KEY = 'STUDY_HELPER_DATA_v1';
const INTERVALS = [0,1,3,7,14];

let cards = [];
let currentEditId = null;

// DOM
const listEl = document.getElementById('list');
const btnNew = document.getElementById('btnNew');
const btnStudy = document.getElementById('btnStudy');
const btnQuiz = document.getElementById('btnQuiz');
const btnExport = document.getElementById('btnExport');
const btnImport = document.getElementById('btnImport');
const btnReset = document.getElementById('btnReset');
const fileInput = document.getElementById('fileInput');

const frontIn = document.getElementById('front');
const backIn = document.getElementById('back');
const noteIn = document.getElementById('note');
const tagsIn = document.getElementById('tags');
const saveBtn = document.getElementById('saveBtn');
const newClear = document.getElementById('newClear');

const searchIn = document.getElementById('search');
const tagFilter = document.getElementById('tagFilter');
const onlyDue = document.getElementById('onlyDue');

const editor = document.getElementById('editor');
const studyPanel = document.getElementById('studyPanel');
const studyCard = document.getElementById('studyCard');
const cardFront = document.getElementById('cardFront');
const cardNote = document.getElementById('cardNote');
const showAnswer = document.getElementById('showAnswer');
const answerArea = document.getElementById('answerArea');
const theAnswer = document.getElementById('theAnswer');
const btnCorrect = document.getElementById('btnCorrect');
const btnWrong = document.getElementById('btnWrong');
const btnBack = document.getElementById('btnBack');
const studyTitle = document.getElementById('studyTitle');
const progressInfo = document.getElementById('progressInfo');
const statsInfo = document.getElementById('statsInfo');

const quizPanel = document.getElementById('quizPanel');
const quizCount = document.getElementById('quizCount');
const quizTime = document.getElementById('quizTime');
const startQuiz = document.getElementById('startQuiz');
const quizArea = document.getElementById('quizArea');
const quizQ = document.getElementById('quizQ');
const quizChoices = document.getElementById('quizChoices');
const quizTimer = document.getElementById('quizTimer');
const quizProgress = document.getElementById('quizProgress');
const quizScore = document.getElementById('quizScore');

// load/save
function load(){
  try{ const raw = localStorage.getItem(KEY); cards = raw ? JSON.parse(raw) : []; }
  catch(e){ cards = []; }
}
function save(){ localStorage.setItem(KEY, JSON.stringify(cards)); }

// helpers
function uid(){ return Math.random().toString(36).slice(2,9); }
function todayISO(){ const d=new Date(); d.setHours(0,0,0,0); return d.toISOString(); }
function daysFromNow(n){ const d=new Date(); d.setDate(d.getDate()+n); d.setHours(0,0,0,0); return d.toISOString(); }
function isDue(c){ return !c.nextReview || new Date(c.nextReview) <= new Date(); }
function parseTags(s){ return (s||'').split(',').map(x=>x.trim()).filter(Boolean); }
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

// UI
function ensureSample(){
  if(cards.length===0){
    cards.push({id:uid(),front:'Haus',back:'house',note:'das Haus',tags:['Vokabel'],box:1,nextReview:todayISO(),correct:0,wrong:0,created:new Date().toISOString()});
    save();
  }
}
function renderList(){
  listEl.innerHTML='';
  const q = (searchIn.value||'').toLowerCase();
  const tag = tagFilter.value;
  const only = onlyDue.checked;
  const filtered = cards.filter(c=>{
    if(q && !(c.front||'').toLowerCase().includes(q) && !(c.back||'').toLowerCase().includes(q) && !(c.note||'').toLowerCase().includes(q)) return false;
    if(tag && !(c.tags||[]).includes(tag)) return false;
    if(only && !isDue(c)) return false;
    return true;
  }).sort((a,b)=> new Date(a.nextReview||0)-new Date(b.nextReview||0));
  if(filtered.length===0){ listEl.innerHTML='<div class="muted">Keine Karten.</div>'; return; }
  for(const c of filtered){
    const div = document.createElement('div'); div.className='item';
    const left = document.createElement('div');
    left.innerHTML = `<strong>${escapeHtml(c.front)}</strong><div class="muted">${escapeHtml(c.back)}</div><div class="muted" style="margin-top:6px">Box ${c.box} ‚Ä¢ Tags: ${(c.tags||[]).join(', ')} ‚Ä¢ N√§chste: ${c.nextReview? new Date(c.nextReview).toLocaleDateString() : 'sofort'}</div>`;
    const right = document.createElement('div'); right.style.display='flex'; right.style.gap='6px';
    const btnLearn = document.createElement('button'); btnLearn.textContent='‚ñ∂'; btnLearn.title='Lernen (diese)'; btnLearn.onclick = ()=> startStudy([c]);
    const btnEdit = document.createElement('button'); btnEdit.textContent='‚úèÔ∏è'; btnEdit.onclick = ()=> editCard(c.id);
    const btnDel = document.createElement('button'); btnDel.textContent='üóëÔ∏è'; btnDel.onclick = ()=> { if(confirm('L√∂schen?')){ cards = cards.filter(x=>x.id!==c.id); save(); render(); } };
    right.appendChild(btnLearn); right.appendChild(btnEdit); right.appendChild(btnDel);
    div.appendChild(left); div.appendChild(right);
    listEl.appendChild(div);
  }
  populateTagFilter();
}
function populateTagFilter(){
  const s = new Set(); cards.forEach(c=> (c.tags||[]).forEach(t=>s.add(t)));
  tagFilter.innerHTML = '<option value="">Alle Tags</option>';
  Array.from(s).sort().forEach(t=>{ const o = document.createElement('option'); o.value=t; o.textContent=t; tagFilter.appendChild(o); });
}

// Editor
btnNew.addEventListener('click', ()=>{ currentEditId=null; document.getElementById('editorTitle').textContent='Neue Karte'; frontIn.value=''; backIn.value=''; noteIn.value=''; tagsIn.value=''; frontIn.focus(); });

saveBtn.addEventListener('click', ()=>{
  const f = frontIn.value.trim(); const b = backIn.value.trim();
  if(!f || !b) { alert('Frage und Antwort ausf√ºllen.'); return; }
  const t = parseTags(tagsIn.value);
  if(currentEditId){
    const it = cards.find(x=>x.id===currentEditId);
    if(!it) return;
    it.front=f; it.back=b; it.note=noteIn.value.trim(); it.tags=t;
  } else {
    cards.push({ id:uid(), front:f, back:b, note:noteIn.value.trim(), tags:t, box:1, nextReview:todayISO(), correct:0, wrong:0, created:new Date().toISOString() });
  }
  save(); renderList();
  currentEditId=null; document.getElementById('editorTitle').textContent='Neue Karte'; frontIn.value=''; backIn.value=''; noteIn.value=''; tagsIn.value='';
});
newClear.addEventListener('click', ()=>{ currentEditId=null; document.getElementById('editorTitle').textContent='Neue Karte'; frontIn.value=''; backIn.value=''; noteIn.value=''; tagsIn.value=''; });

function editCard(id){
  const c = cards.find(x=>x.id===id); if(!c) return;
  currentEditId = id; document.getElementById('editorTitle').textContent='Karte bearbeiten';
  frontIn.value = c.front; backIn.value = c.back; noteIn.value = c.note || ''; tagsIn.value = (c.tags||[]).join(', ');
}

// Study (Leitner simple)
let studyQueue = []; let studyIndex = 0; let currentCard = null;
btnStudy.addEventListener('click', ()=> startStudy());
function startStudy(specific){
  let pool = cards.slice().sort((a,b)=> isDue(a)? -1 : 1);
  if(specific && specific.length) pool = specific.slice();
  if(pool.length===0){ alert('Keine Karten vorhanden.'); return; }
  studyQueue = pool;
  studyIndex = 0;
  document.getElementById('editor').style.display='none';
  studyPanel.style.display='block';
  nextStudyCard();
}
function nextStudyCard(){
  if(studyIndex >= studyQueue.length){ // finished
    cardFront.textContent = 'Fertig üéâ'; cardNote.textContent='Gut gemacht!'; answerArea.style.display='none'; showAnswer.style.display='none'; progressInfo.textContent = `0 / ${studyQueue.length}`; return;
  }
  currentCard = studyQueue[studyIndex];
  cardFront.textContent = currentCard.front; cardNote.textContent = currentCard.note || ''; theAnswer.textContent=''; answerArea.style.display='none'; showAnswer.style.display='inline-block';
  progressInfo.textContent = `${studyIndex+1} / ${studyQueue.length}`;
  statsInfo.textContent = `Korrekt: ${currentCard.correct||0} ‚Ä¢ Falsch: ${currentCard.wrong||0} ‚Ä¢ Box: ${currentCard.box||1}`;
}
showAnswer.addEventListener('click', ()=>{ theAnswer.textContent = currentCard.back; answerArea.style.display='flex'; showAnswer.style.display='none'; });
btnCorrect.addEventListener('click', ()=> markStudy(true));
btnWrong.addEventListener('click', ()=> markStudy(false));
btnBack.addEventListener('click', ()=> { studyPanel.style.display='none'; document.getElementById('editor').style.display='block'; });

function markStudy(correct){
  if(!currentCard) return;
  if(correct){ currentCard.correct = (currentCard.correct||0) + 1; currentCard.box = Math.min(5, (currentCard.box||1) + 1); }
  else { currentCard.wrong = (currentCard.wrong||0) + 1; currentCard.box = Math.max(1, (currentCard.box||1) - 1); }
  const days = INTERVALS[Math.max(0,Math.min(4,(currentCard.box||1)-1))] || 0;
  currentCard.nextReview = daysFromNow(days);
  save();
  studyIndex++; nextStudyCard();
}

// Quiz (multiple choice)
btnQuiz.addEventListener('click', ()=>{ quizPanel.style.display = quizPanel.style.display==='none' ? 'block' : 'none'; });
startQuiz.addEventListener('click', ()=> runQuiz());

let quizState = null; let quizTimerInterval = null;

function runQuiz(){
  const count = Math.max(1, Math.min(100, parseInt(quizCount.value||10)));
  const timePer = Math.max(5, parseInt(quizTime.value||20));
  if(cards.length < 2){ alert('Mindestens 2 Karten erforderlich f√ºr Quiz.'); return; }
  // pick random unique questions
  const pool = shuffle(cards.slice());
  const questions = pool.slice(0, Math.min(count, pool.length));
  quizState = { q: questions, idx:0, score:0, timePer, total:questions.length };
  document.getElementById('editor').style.display='none';
  quizArea.style.display='block';
  setupQuizQuestion();
}

function setupQuizQuestion(){
  const s = quizState;
  if(!s || s.idx >= s.total){ finishQuiz(); return; }
  const card = s.q[s.idx];
  quizQ.textContent = card.front;
  // choices: correct back + 3 random backs
  const others = cards.filter(c=>c.id !== card.id);
  const choices = [card.back];
  shuffle(others);
  for(let i=0;i<3 && i<others.length;i++) choices.push(others[i].back);
  shuffle(choices);
  quizChoices.innerHTML = '';
  choices.forEach(ch=>{
    const b = document.createElement('button'); b.className='small'; b.style.textAlign='left'; b.textContent = ch;
    b.onclick = ()=> { if(ch === card.back){ s.score++; quizScore.textContent = 'Score: ' + s.score; } nextQuizQuestion(); };
    quizChoices.appendChild(b);
  });
  quizProgress.textContent = `${s.idx+1} / ${s.total}`;
  quizTimer.textContent = `Zeit: ${s.timePer}s`;
  // timer
  let remaining = s.timePer;
  clearInterval(quizTimerInterval);
  quizTimerInterval = setInterval(()=> { remaining--; quizTimer.textContent = `Zeit: ${remaining}s`; if(remaining<=0){ clearInterval(quizTimerInterval); nextQuizQuestion(); } }, 1000);
}

function nextQuizQuestion(){
  clearInterval(quizTimerInterval);
  quizState.idx++; setupQuizQuestion();
}

function finishQuiz(){
  clearInterval(quizTimerInterval);
  alert('Quiz beendet. Score: ' + (quizState.score||0) + ' / ' + quizState.total);
  quizState = null;
  quizArea.style.display='none';
  document.getElementById('editor').style.display='block';
}

// Import/Export
btnExport.addEventListener('click', ()=>{
  const data = { exportedAt: new Date().toISOString(), cards };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'study_backup_' + new Date().toISOString().slice(0,10) + '.json'; a.click(); URL.revokeObjectURL(url);
});
btnImport.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', async (e) => {
  const f = e.target.files[0]; if(!f) return;
  try {
    const txt = await f.text();
    const parsed = JSON.parse(txt);
    if(parsed && Array.isArray(parsed.cards || parsed.cards === undefined ? parsed.cards : parsed.cards )){
      const list = parsed.cards || parsed.cards; // fallback
      if(!Array.isArray(list) && parsed.cards && Array.isArray(parsed.cards)) list = parsed.cards;
      if(!Array.isArray(list)) {
        // try older format: parsed.cards may be undefined, try parsed directly
        if(Array.isArray(parsed)) list = parsed;
      }
      if(!list || !Array.isArray(list)){ alert('Ung√ºltiges Format.'); fileInput.value=''; return; }
      if(confirm('Anh√§ngen (OK) oder √úberschreiben (Abbrechen)?')) {
        // append avoiding id collisions
        const existing = new Set(cards.map(c=>c.id));
        for(const it of list){
          if(!it.id) it.id = uid();
          if(existing.has(it.id)) it.id = uid();
          cards.push(it);
        }
      } else {
        cards = list.map(it => it.id ? it : {...it, id: uid()});
      }
      save(); renderList(); alert('Import erfolgreich.');
    } else {
      alert('Unbekanntes Format.');
    }
  } catch(err){ alert('Import Fehler: ' + err.message); } finally { fileInput.value=''; }
});

// Reset
btnReset.addEventListener('click', ()=> { if(confirm('Alle Karten l√∂schen?')){ cards=[]; save(); renderList(); } });

// util
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

// init
load(); ensureSample(); renderList();

searchIn.addEventListener('input', renderList);
tagFilter.addEventListener('change', renderList);
onlyDue.addEventListener('change', renderList);

</script>
</body>
</html>